---
import { getCollection, type CollectionEntry } from "astro:content";

import ProjectCard from "@/components/project/ProjectCard.astro";
import ProjectCardHeader from "@/components/project/ProjectCardHeader.astro";
import Section from "@/components/Section.astro";

const projects = await getCollection("project");

type Project = CollectionEntry<"project">;
const isFeatured = (project: Project) => project.data.isFeatured;
const alphabeticSort = (a: Project, b: Project) => a.id.localeCompare(b.id);
---

<Section title="Projects">
  <h3 slot="header">
    <a href="/projects/1/" class="hoverable" set:text="Projects" /></h3
  >

  <ol>
    {
      projects
        .filter(isFeatured)
        .sort(alphabeticSort)
        .map((project, i) => (
          <li>
            <span class="marker | ff-dotmatrix">
              {i.toString().padStart(2, "0")}
            </span>
            <ProjectCard project={project} />
          </li>
        ))
    }
    <li>
      <span class="marker | ff-dotmatrix">++</span>
      <ProjectCardHeader
        slug="projects/1"
        title="All Projects"
        subtitle="Yes, there are more :)"
      />
    </li>
  </ol>
</Section>

<style lang="scss">
  h3 {
    margin-bottom: var(--space-fluid-s);
    font-family: var(--ff-pixelated);
    font-size: calc(var(--fs-fluid-2) * 0.8);
    letter-spacing: var(--letter-spacing-fluid-header);

    &::after {
      content: "...";
      color: var(--color-text-subdued);
      padding-left: 0.25ch;
      transition: letter-spacing 0.2s ease-in-out;
    }

    &:has(a:is(:hover, :focus))::after {
      content: "_..";
      letter-spacing: 0.25em;
    }
  }

  ol {
    margin-left: 12px;
    display: flex;
    flex-direction: column;
    row-gap: 1.125rem;
  }

  li {
    display: grid;
    grid-template-columns: 24px 1fr;
    column-gap: 2ch;

    .marker {
      justify-self: center;
      padding-top: 1.5px;
      color: var(--color-text-subdued);
      font-weight: bold;
      white-space: nowrap;
      transition: color 0.25s ease-in-out;

      @media (prefers-reduced-motion: no-preference) {
        @supports (view-timeline-name: --item-timeline) {
          view-timeline-name: --item-timeline;
          animation-name: marker--reveal;
          animation-fill-mode: both;
          animation-timeline: --item-timeline;
          animation-range: cover 0% cover 10%;
        }
      }
    }

    &:has(.title:is(:hover, :active, :focus-within)) {
      .marker {
        color: var(--color-text-primary);
      }
    }
  }

  @keyframes marker--reveal {
    from {
      opacity: 0;
      translate: 0 5vh;
    }
  }
</style>
